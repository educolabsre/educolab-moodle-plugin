{"version":3,"file":"script.min.js","sources":["../src/script.js"],"sourcesContent":["define(['jquery', 'core/ajax'], function($, Ajax) {\n    return {\n        init: function() {\n            const pages = {\n                initialState: document.getElementById('page-initialState'),\n                cadastro: document.getElementById('page-cadastro'),\n                analise: document.getElementById('page-analise'),\n                recorrencia: document.getElementById('page-recorrencia'),\n                personalizar: document.getElementById('page-personalizar'),\n            };\n\n            let forumCadastrado = false;\n\n            function switchPage(pageKey) {\n                Object.values(pages).forEach(page => page.classList.remove('active'));\n                pages[pageKey].classList.add('active');\n            }\n\n            const toastEl = document.getElementById(\"successToast\");\n\n            const toast = new bootstrap.Toast(toastEl, { autohide: false });\n\n            function showToast(message, status) {\n                const toastEl = document.getElementById(\"successToast\");\n                const toastHeader = document.querySelector(\".toast-header\");\n                const toastHeaderTitle = document.getElementById(\"toast-header-title\");\n                const toastBody = document.querySelector(\".toast-body\");\n\n                const statusClasses = {\n                    success: {\n                        name: 'toast-success',\n                        header: { name: 'toast-header-success' },\n                    },\n                    error: {\n                        name: 'toast-error',\n                        header: { name: 'toast-header-error' },\n                    },\n                };\n\n                toastEl.classList.remove(status == \"success\" ? statusClasses.error.name : statusClasses.success.name);\n                toastEl.classList.add(statusClasses?.[status].name);\n\n                toastHeader.classList.remove(status == \"success\" ? statusClasses.error.header.name : statusClasses.success.header.name);\n                toastHeader.classList.add(statusClasses?.[status].header.name);\n                \n                toastBody.innerHTML = message;\n                toastHeaderTitle.innerHTML = status == \"success\" ? \"Sucesso\" : \"Erro\";\n\n                toast.show();\n            }\n\n            $(document).ready(function () {\n                const forumInfoElement = document.getElementById('forum-info');\n\n                const url = 'http://localhost:3000/checar-cadastro';\n\n                fetch(url, {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify({\n                        forumID: forumInfoElement.dataset.forumid\n                    })\n                })\n                .then((response) => {\n                    if (!response.ok) {\n                        throw new Error(`HTTP error! status: ${response.status}`);\n                    }\n                    \n                    return response.json();\n                })\n                .then((data) => {\n                    if(!!data) {\n                        const firstOption = document.getElementById('monitoramento');\n                        firstOption.innerHTML = \"Editar monitoramento\";\n\n                        const buttonText = document.getElementById('button-monitoramento');\n                        buttonText.innerHTML = \"Editar monitoramento\";\n    \n                        document.querySelectorAll('.list-group-item').forEach((item) => item.classList.remove('disabled'));\n\n                        const firstDateInput = document.getElementById('start-date-input');\n                        firstDateInput.classList.add('page');\n\n                        forumCadastrado = true;\n\n                    } else {\n                        forumCadastrado = false;\n                    }\n                })\n                .catch((err) => {\n                    console.log(err);\n                });\n\n                $('.close').on('click', function() {\n                    toast.hide();\n                });\n\n                $('#cadastro').on('click', function() {\n                    switchPage('cadastro');\n\n                    document.getElementById('back-arrow').classList.add('active');\n\n                    $('#back-arrow').on('click', function() {\n                        switchPage('initialState');\n                        document.getElementById('back-arrow').classList.remove('active');\n                    });\n\n                    $('#btn-cadastro').on('click', function() {\n                        const button = document.getElementById(\"btn-cadastro\");\n\n                        button.setAttribute('disabled', 'true');\n                        button.querySelector('.spinner-border').classList.remove('d-none');\n\n                        const forumInfoElement = document.getElementById('forum-info');\n\n                        const forumId = forumInfoElement.dataset.forumid;\n\n                        const startDate = document.getElementById(\"start-date\").value;\n                        const endDate = document.getElementById(\"end-date\").value;\n\n                        Ajax.call([{\n                            methodname: 'block_educolab_save_monitoring_dates',\n                            args: {\n                                forumid: forumId,\n                                start_date: startDate,\n                                end_date: endDate\n                            },\n                            done: function() {\n\n                            },\n                            fail: function(error) {\n                                \n                            }\n                        }]);\n\n                        const url = forumCadastrado ? 'http://localhost:3000/atualizar-cadastro' : 'http://localhost:3000/cadastro';\n\n                        const students = window.educolab.students;\n\n                        const csv_header = [\"Nome\", \"Sobrenome\", \"Email\"];\n                        const csv_rows = students.map(student => [student.id, student.firstname, student.lastname, student.email]);\n\n                        const csv_students = [\n                            csv_header.join(','),\n                            ...csv_rows.map(row => row.join(','))\n                        ].join('\\n');\n\n                        const reqBody = forumCadastrado ? JSON.stringify({\n                            forumID: forumId,\n                            data_final: endDate\n\n                        }) : JSON.stringify({\n                            identifica_forum: forumInfoElement.dataset.identificaforum,\n                            nome_professor: forumInfoElement.dataset.nomeprofessor,\n                            email_professor: forumInfoElement.dataset.emailprofessor,\n                            link_forum: forumInfoElement.dataset.linkforum,\n                            data_inicio: startDate,\n                            data_final: endDate,\n                            estudantes: csv_students,\n                            confirmacao: forumInfoElement.dataset.confirmacao\n                        });\n\n                        fetch(url, {\n                            method: 'POST',\n                            headers: {\n                                'Content-Type': 'application/json'\n                            },\n                            body: reqBody\n                        })\n                        .then(response => {\n                            if(!response.ok) {\n                                throw new Error('Request error');\n                            }\n                            return response.json();\n                        })\n                        .then(data => {\n                            button.querySelector('.spinner-border').classList.add('d-none');\n                            button.removeAttribute('disabled');\n\n                            if(data?.error) {\n                                showToast(data?.error, \"error\");\n\n                            } else if(data?.success) {\n                                showToast(data?.success, \"success\");\n\n                                document.querySelectorAll('.list-group-item').forEach((item) => item.classList.remove('disabled'));\n                                document.getElementById('back-arrow').classList.remove('active');\n\n                                const firstOption = document.getElementById('monitoramento');\n                                firstOption.innerHTML = \"Editar monitoramento\";\n\n                                switchPage('initialState');\n                            }\n                        })\n                        .catch(error => {\n                            console.error('Error', error);\n                        })\n                        .finally(() => {\n                            button.querySelector('.spinner-border').classList.add('d-none');\n                            button.removeAttribute('disabled');\n                        });\n                    });\n                });\n\n                $('#analise').on('click', function() {\n                    switchPage('analise');\n\n                    document.getElementById('back-arrow').classList.add('active');\n\n                    $('#back-arrow').on('click', function() {\n                        switchPage('initialState');\n                        document.getElementById('back-arrow').classList.remove('active');\n                    });\n\n                    $('#btn-analise').on('click', function() {\n                        const button = document.getElementById(\"btn-analise\");\n\n                        button.setAttribute('disabled', 'true');\n                        button.querySelector('.spinner-border').classList.remove('d-none');\n                        \n                        const forumInfoElement = document.getElementById('forum-info');\n    \n                        const url = 'http://localhost:3000/analise';\n    \n                        const messages = window.educolab.messages;\n    \n                        const csv_header = [\"id\",\"discussion\",\"parent\",\"userid\",\"userfullname\",\"created\",\"modified\",\"mailed\",\"subject\",\"message\",\"wordcount\"];\n                        const csv_rows = messages.map(message => [message.id, message.discussion, message.parent, message.userid, message.userfullname, message.created, message.modified, message.mailed, message.subject, message.message, message.wordcount]);\n    \n                        const csv_messages = [\n                            csv_header.join(','),\n                            ...csv_rows.map(row => row.join(','))\n                        ].join('\\n');\n    \n                        fetch(url, {\n                            method: 'POST',\n                            headers: {\n                                'Content-Type': 'application/json'\n                            },\n                            body: JSON.stringify({\n                                forumID: forumInfoElement.dataset.forumid,\n                                messages: csv_messages\n                            })\n                        })\n                        .then(response => {\n                            if(!response.ok) {\n                                throw new Error('Request error');\n                            }\n                            return response.json();\n                        })\n                        .then(data => {\n                            console.log(data);\n                            \n                            button.querySelector('.spinner-border').classList.add('d-none');\n                            button.removeAttribute('disabled');\n    \n                            if(data?.error) {\n                                showToast(data?.error, \"error\");\n    \n                            } else if(data?.success) {\n                                showToast(data?.success, \"success\");\n    \n                                document.getElementById('back-arrow').classList.remove('active');\n    \n                                switchPage('initialState');\n                            }\n                        })\n                        .catch(error => {\n                            console.error('Error', error);\n                        })\n                        .finally(() => {\n                            button.querySelector('.spinner-border').classList.add('d-none');\n                            button.removeAttribute('disabled');\n                        });\n                    });\n                });\n\n                $('#recorrencia').on('click', function() {\n                    switchPage('recorrencia');\n\n                    document.getElementById('back-arrow').classList.add('active');\n\n                    $('#back-arrow').on('click', function() {\n                        switchPage('initialState');\n                        document.getElementById('back-arrow').classList.remove('active');\n                    });\n                });\n\n                $('#personalizar').on('click', function() {\n                    switchPage('personalizar');\n\n                    document.getElementById('back-arrow').classList.add('active');\n\n                    $('#back-arrow').on('click', function() {\n                        switchPage('initialState');\n                        document.getElementById('back-arrow').classList.remove('active');\n                    });\n                });\n\n                $('#save-schedule-btn').on('click', function() {\n                    const recurrence = $('#interval').val();\n                    const startDate = $('#start_date').val();\n    \n                    const forumInfoElement = document.getElementById('forum-info');\n    \n                    const forumId = forumInfoElement.dataset.forumid;\n                    const courseId = forumInfoElement.dataset.courseid;\n    \n                    if (!recurrence || !startDate) {\n                        alert(Str.get_string('fillallfields', 'block_educolab'));\n                        return;\n                    }\n\n                    const intervalsText = {\n                        daily: \"diariamente\",\n                        weekly: \"semanalmente\",\n                        two_weeks: \"a cada duas semanas\",\n                        three_weeks: \"a cada três semanas\",\n                        monthly: \"mensalmente\"\n                    }\n    \n                    Ajax.call([{\n                        methodname: 'block_educolab_save_schedule',\n                        args: {\n                            forumId: forumId,\n                            courseId: courseId,\n                            recurrence: recurrence,\n                            start_date: startDate\n                        },\n                        done: function() {\n                            showToast(`O fórum será analisado ${intervalsText?.[recurrence]}, a partir de ${startDate.split('-').reverse().join('/')}.`, \"success\");\n                            switchPage('initialState');\n                            document.getElementById('back-arrow').classList.remove('active');\n                        },\n                        fail: function(error) {\n                            showToast('Não foi possível agendar as análises, tente novamente mais tarde.')\n                            console.log(error);\n                        }\n                    }]);\n                });\n            });\n        }\n    };\n});"],"names":["define","$","Ajax","init","pages","initialState","document","getElementById","cadastro","analise","recorrencia","personalizar","forumCadastrado","switchPage","pageKey","Object","values","forEach","page","classList","remove","add","toastEl","toast","bootstrap","Toast","autohide","showToast","message","status","toastHeader","querySelector","toastHeaderTitle","toastBody","statusClasses","success","name","header","error","innerHTML","show","ready","forumInfoElement","fetch","method","headers","body","JSON","stringify","forumID","dataset","forumid","then","response","ok","Error","json","data","querySelectorAll","item","catch","err","console","log","on","hide","button","setAttribute","forumId","startDate","value","endDate","call","methodname","args","start_date","end_date","done","fail","url","csv_rows","window","educolab","students","map","student","id","firstname","lastname","email","csv_students","join","row","reqBody","data_final","identifica_forum","identificaforum","nome_professor","nomeprofessor","email_professor","emailprofessor","link_forum","linkforum","data_inicio","estudantes","confirmacao","removeAttribute","finally","messages","discussion","parent","userid","userfullname","created","modified","mailed","subject","wordcount","csv_messages","recurrence","val","courseId","courseid","alert","Str","get_string","intervalsText","daily","weekly","two_weeks","three_weeks","monthly","split","reverse"],"mappings":"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"}